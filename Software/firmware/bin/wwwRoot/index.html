<!DOCTYPE html>
<html>

<head>
   
   <title>PHI Admin Console</title>

   <script>
/*      
      function refreshPhiData()
      {
        document.getElementById("phi_hostname").innerHTML= "ubuntu";
        document.getElementById("phi_ipaddr").innerHTML= "1.2.3.4";

        // call again in 5 seconds
        window.setTimeout(refreshPhiData, 5000);
      }      
    */

      function jsonReplyListener () {
        
        // alert("received JSON reply");
        
        if (this.readyState === 4) {
          if (this.status === 200) {
            // alert(this.responseText);
            var obj = eval ("(" + this.responseText + ")");
            if (obj == null) {
              alert("jsonReplyListener: JSON obj eval failed");
            }
            parseJsonReply(obj);
          } else {
            alert('jsonReplyListener: There was a problem with the JSON request.');
          }
        }
      }

      function parseJsonReply(obj) {
        var num = obj.reply.length;
        for (var i = 0 ; i < num ; i++) {
          var reply = obj.reply[i];
          // alert("obj.reply[" + i + "].cmd = " + reply.cmd);
          switch (reply.cmd) {
            case "getVersion":
              document.getElementById("phi_firmware_version").innerHTML = reply.version;
              break;
            case "getHost":
              document.getElementById("phi_hostname").innerHTML = reply.name;
              document.getElementById("phi_ipaddr").innerHTML = reply.ip;
              break;
            default:
              alert("unknown JSON reply - cmd: '" + reply.cmd + "'");
              break;
          }
        }
      }

      function sendJsonRequest(json) {

        // alert("sending JSON request:" + json);

        var httpRequest;

        if (window.XMLHttpRequest) {
          // Mozilla, Safari, ...
          httpRequest = new XMLHttpRequest();
        } else if (window.ActiveXObject) {
          // IE
          try {
            httpRequest = new ActiveXObject("Msxml2.XMLHTTP");
          } 
          catch (e) {
            try {
              httpRequest = new ActiveXObject("Microsoft.XMLHTTP");
            } 
            catch (e) {}
          }
        }

        if (!httpRequest) {
          alert('error: cannot create an XMLHTTP instance');
          return false;
        }

        httpRequest.onreadystatechange = jsonReplyListener;

        httpRequest.open('POST', "postJson");
        httpRequest.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
        httpRequest.setRequestHeader("Content-length", json.length);
        httpRequest.setRequestHeader("Connection", "close");
        httpRequest.setRequestHeader("Content-type", "application/json");
        
        httpRequest.send(json);
      }

      function testButtonPressed() {
        // alert("button pressed");
        sendJsonRequest("req : [ {cmd:getVersion}, {cmd:getHost} ]");
      }

   </script>
      
</head>

<body>

   <table>
      
      <tr>
         <td>
            <!-- Icon -->
            <img src="./images/phi_letter.jpg" height=150 width=150> </img>
         </td>
         <td>
            <!-- Title -->
            <img src="./images/phi_text.jpg" height=80> </img>
            <img src="./images/phi_text.jpg"height=80> </img>
            <img src="./images/phi_text.jpg"height=80> </img>
            <img src="./images/phi_text.jpg"height=80> </img>
            <img src="./images/phi_text.jpg"height=80> </img>
            </br>
            <h1> &nbsp; Admin Console </h1>
         </td>
      </tr>
      
      <tr>
         <td>
            <!-- Navigation -->
            nav buttons go here
         </td>
         <td style="padding: 20px;">
            
 <!-- MAIN PANE -->
            
<h1> PHI says HI</b> </h1>

TEST: </p>

<table>
   
   <tr> 
      <td>firmware version</td>
      <td>=</td>
      <td>&nbsp; <span id="phi_firmware_version">v</span></td>
   </tr>
   
   <tr> 
      <td>hostname</td>
      <td>=</td>
      <td>&nbsp; <span id="phi_hostname">n</span></td>
   </tr>
   
   <tr>
      <td>ipAddr</td>
      <td>=</td>
      <td>&nbsp; <span id="phi_ipaddr">ip</span></td>
   </tr>
   
</table>

</br>

<input type="button" onclick="testButtonPressed()" value="Test">

 <!-- END OF MAIN PANE -->

         </td>
      </tr>
   </table>

   <script>
//      refreshPhiData();
   </script>
   
</body>
</html>